<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <title>undefined</title>
  <meta name="generator" content="Google Web Designer 15.2.1.0306">
  <style id="gwd-text-style">
    p {
      margin: 0px;
    }
    h1 {
      margin: 0px;
    }
    h2 {
      margin: 0px;
    }
    h3 {
      margin: 0px;
    }
  </style>
  <style>
    html, body {
      width: 100%;
      height: 100%;
      margin: 0px;
    }
    body {
      background-color: transparent;
      transform: perspective(1400px) matrix3d(1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1);
      transform-style: preserve-3d;
    }
    body * {
      transform-style: preserve-3d;
    }
    .gwd-button-1po1 {
      position: absolute;
      font-family: "Gothic A1";
      left: 50%;
      font-size: 18px;
      height: 45px;
      width: 326px;
      transform: translate(-50%, 0%) translate3d(77px, 88px, 0px);
      top: 0px;
    }
    .gwd-button-12td {
      position: absolute;
      font-family: "Gothic A1";
      left: 50%;
      font-size: 18px;
      height: 45px;
      width: 326px;
      transform: translate(-50%, 0%) translate3d(77px, 152px, 0px);
      top: 0px;
    }
    .gwd-button-7hur {
      position: absolute;
      font-family: "Gothic A1";
      left: 50%;
      font-size: 18px;
      height: 45px;
      width: 326px;
      transform: translate(-50%, 0%) translate3d(77px, 216px, 0px);
      top: 0px;
    }
    .gwd-div-auya {
      position: absolute;
      width: 143px;
      height: 45px;
      background-image: none;
      background-color: rgb(239, 239, 239);
      border-width: 2px;
      left: 50%;
      border-style: outset;
      transform: translate(-50%, 0%) translate3d(-176px, 85px, 0px);
      top: 0px;
    }
    .gwd-div-7i7i {
      position: absolute;
      width: 143px;
      height: 45px;
      background-image: none;
      background-color: rgb(239, 239, 239);
      border-width: 2px;
      left: 50%;
      border-style: outset;
      transform: translate(-50%, 0%) translate3d(-176px, 149px, 0px);
      top: 0px;
    }
    .gwd-div-1lii {
      position: absolute;
      width: 143px;
      height: 45px;
      background-image: none;
      background-color: rgb(239, 239, 239);
      border-width: 2px;
      left: 50%;
      border-style: outset;
      transform: translate(-50%, 0%) translate3d(-176px, 215px, 0px);
      top: 0px;
    }
    .gwd-p-pqlx {
      position: absolute;
      font-size: 18px;
      font-family: "Gothic A1";
      width: 42px;
      height: 23px;
      left: 50%;
      transform: translate(-50%, 0%) translate3d(-215px, 99px, 0px);
      top: 0px;
    }
    .gwd-p-hz8u {
      position: absolute;
      font-size: 18px;
      font-family: "Gothic A1";
      width: 42px;
      height: 23px;
      left: 50%;
      transform: translate(-50%, 0%) translate3d(-215px, 163px, 0px);
      top: 0px;
    }
    .gwd-p-1hv8 {
      position: absolute;
      font-size: 18px;
      font-family: "Gothic A1";
      width: 42px;
      height: 23px;
      left: 50%;
      transform: translate(-50%, 0%) translate3d(-215px, 227px, 0px);
      top: 0px;
    }
    .gwd-p-198k {
      position: absolute;
      font-size: 18px;
      font-family: "Gothic A1";
      width: 42px;
      height: 23px;
      left: 50%;
      transform: translate(-50%, 0%) translate3d(-155px, 99px, 0px);
      top: 0px;
    }
    .gwd-p-1l3j {
      position: absolute;
      font-size: 18px;
      font-family: "Gothic A1";
      height: 23px;
      width: 74px;
      left: 50%;
      transform: translate(-50%, 0%) translate3d(-139px, 162px, 0px);
      top: 0px;
    }
    .gwd-p-vquz {
      position: absolute;
      font-size: 18px;
      font-family: "Gothic A1";
      width: 42px;
      height: 23px;
      left: 50%;
      transform: translate(-50%, 0%) translate3d(-155px, 228px, 0px);
      top: 0px;
    }
    .gwd-img-1rer {
      position: absolute;
      width: 489.5px;
      left: 50%;
      top: 0px;
      transform: translate(-50%, 0%) translate3d(-5px, 294px, 0px);
    }
  </style>
  <link href="https://fonts.googleapis.com/css?family=Noto+Sans+JP:100,200,300,regular,500,600,700,800,900|Gothic+A1:100,200,300,regular,500,600,700,800,900" rel="stylesheet" type="text/css">
</head>

<body class="htmlNoPages">
  <button id="first" class="gwd-button-1po1">TNT vs 로직</button>
  <button id="second" class="gwd-button-7hur">윈 vs 퀘이사</button>
  <button id="third" class="gwd-button-12td">라이빗 vs 로톨</button>
  <div class="gwd-div-auya" id="d1"></div>
  <div class="gwd-div-1lii" id="d1_2"></div>
  <div class="gwd-div-7i7i" id="d1_1"></div>
  <p class="gwd-p-pqlx" id="p1">5/30</p>
  <p class="gwd-p-198k" id="p1_3">축구</p>
  <p class="gwd-p-vquz" id="p1_5">농구</p>
  <p class="gwd-p-1l3j" id="p1_4">배드민턴</p>
  <p class="gwd-p-1hv8" id="p1_2">5/30</p>
  <p class="gwd-p-hz8u" id="p1_1">5/30</p>
  <img class="gwd-img-1rer" id="img" src="./img/2_1.jpg">
  <script src="/socket.io/socket.io.js"></script>
  <script>
    let socket = io();
    const first = document.querySelector('#first');
    const second = document.querySelector('#second');
    const third = document.querySelector('#third');

    let bettingWin;

    let id = 0;
    let key = sessionStorage.getItem("key");
    let name = sessionStorage.getItem("name");

    let total_money;
    let team_bet = [0, 0];
    let team_rate = [0, 0];
    let team_name = ["", ""]
    let is_bet = [false, false, false]

    let balance = 0;

    first.addEventListener('click', firstListener);
    second.addEventListener('click', secondListener);
    third.addEventListener('click', thirdListener);

    socket.on('update', (data) => {
      console.log(data);
      total_money = data["games"][id]["total"];
      team_bet[0] = data["games"][id]["team1"]["betAmount"];
      team_bet[1] = data["games"][id]["team2"]["betAmount"];
      team_rate[0] = data["games"][id]["rate"]["team1"];
      team_rate[1] = data["games"][id]["rate"]["team2"];
      team_name[0] = data["games"][id]["team1"]["name"];
      team_name[1] = data["games"][id]["team2"]["name"];
      if (bettingWin) {
        setTimeout(() => {
          bettingWin.document.getElementById('total_money').innerHTML = "전체 배팅 금액: " + total_money;
          //get team name
          bettingWin.document.getElementById('team1_bet').innerHTML = team_name[0] + "배팅금액: " + team_bet[0];
          bettingWin.document.getElementById('team2_bet').innerHTML = team_name[1] + "배팅금액: " + team_bet[1];
          bettingWin.document.getElementById('team1_rate').innerHTML = team_rate[0];
          bettingWin.document.getElementById('team2_rate').innerHTML = team_rate[1];
          bettingWin.document.getElementById('option1').innerHTML = team_name[0];
          bettingWin.document.getElementById('option2').innerHTML = team_name[1];
          bettingWin.document.getElementById('option1').setAttribute("value", team_name[0]);
          bettingWin.document.getElementById('option2').setAttribute("value", team_name[1]);
        }, 100);
      }
    });
    socket.on('money', (data) => {
      balance = data["balance"];
      if (bettingWin) {
        setTimeout(() => {
          bettingWin.document.getElementById('balance').innerHTML = balance;
        }, 100);
      }
    });

    const init = () => {
      if (is_bet[id]) disableWindow();
      bettingWin.document.getElementById('bet_button').addEventListener('click', () => {
        let team = bettingWin.document.getElementById('team_select').value;
        let bet_amount = bettingWin.document.getElementById('bet_amount').value;
        let team1_score = bettingWin.document.getElementById('team1_score').value;
        let team2_score = bettingWin.document.getElementById('team2_score').value;
        //null check
        if (team == "" || bet_amount == "" || team1_score == "" || team2_score == "") {
          bettingWin.alert("빈칸을 채워주세요.");
          return;
        }
        bettingWin.alert("배팅이 완료되었습니다.");
        socket.emit('bet', {
          key: key,
          name: name,
          team: team,
          amount: bet_amount,
          gameId: id
        });
        socket.emit('betscore', {
          key: key,
          name: name,
          score: [team1_score, team2_score],
          gameId: id
        });
        disableWindow();
      });
      bettingWin.document.getElementById('cancel_bet_button').addEventListener('click', () => {
        console.log("cancel");
        socket.emit('cancelbet', {
          key: key,
          name: name,
          gameId: id
        });
        socket.emit('cancelbetscore', {
          key: key,
          name: name,
          gameId: id
        });
        enableWindow();
      });
    }

    socket.on('stop', (data) => {
      if (bettingWin) {
        setTimeout(() => {
          disableWindow()
        }, 100);
      }
        if(data.gameId == 0) {
            document.getElementById('first').removeEventListener('click', firstListener);
            document.getElementById('first').addEventListener('click', () => {
                alert("베팅이 종료되었습니다.");
            });
        } else if(data.gameId == 1) {
            document.getElementById('second').removeEventListener('click', secondListener);
            document.getElementById('second').addEventListener('click', () => {
                alert("베팅이 종료되었습니다.");
            });
        } else if(data.gameId == 2) {
            document.getElementById('third').removeEventListener('click', thirdListener);
            document.getElementById('third').addEventListener('click', () => {
                alert("베팅이 종료되었습니다.");
            });
        }
    });

    function firstListener() {
      id = 0;
      if (bettingWin) {
        bettingWin.close();
      }
      bettingWin = window.open("betting.html", "childForm", "width=570, height=350, resizable = no, scrollbars = no");
      socket.emit("money", {
        key: key,
        name: name
      });
      setTimeout(init, 500);
    }

    function secondListener() {
      id = 1;
      if (bettingWin) {
        bettingWin.close();
      }
      bettingWin = window.open("betting.html", "childForm", "width=570, height=350, resizable = no, scrollbars = no");
      socket.emit("money", {
        key: key,
        name: name
      });
      setTimeout(init, 500);
    }

    function thirdListener() {
      id = 2;
      if (bettingWin) {
        bettingWin.close();
      }
      bettingWin = window.open("betting.html", "childForm", "width=570, height=350, resizable = no, scrollbars = no");
      socket.emit("money", {
        key: key,
        name: name
      });
      setTimeout(init, 500);
    }

    function enableWindow() {
      bettingWin.document.getElementById('bet_button').disabled = false;
      bettingWin.document.getElementById('bet_amount').disabled = false;
      bettingWin.document.getElementById('team1_score').disabled = false;
      bettingWin.document.getElementById('team2_score').disabled = false;
      bettingWin.document.getElementById('team_select').disabled = false;
    }

    function disableWindow() {
      bettingWin.document.getElementById('bet_button').disabled = true;
      bettingWin.document.getElementById('bet_amount').disabled = true;
      bettingWin.document.getElementById('team1_score').disabled = true;
      bettingWin.document.getElementById('team2_score').disabled = true;
      bettingWin.document.getElementById('team_select').disabled = true;
    }

    setInterval(() => {
      socket.emit("money", {
        key: key,
        name: name
      });
    }, 1000);

  </script>
</body>

</html>